<!DOCTYPE html>
<html lang="en">
    <%- include('../partials/head', {title: title}); %>
<body>
    <%- include('../partials/header', {title: title}); %>
    <main>
        <p><%- msg %></p>
        <div class="insert" style="display: block;">
            <h3>Vložení dat</h3>
            <form action="/vozidlo/pridat" method="post" id="vozidlo">
                <input type="hidden" name="table" id="table" value="vozidlo" required>
                <label for="id_u">Úřad</label>
                <select name="id_u" id="id_u">
                    <option value="" selected>Vyberte úřad</option>
                    <% if (urad) {
                        for(var i=0; i < urad.length; i++) { %>
                        <option value="<%=urad[i].id_u%>"><%=urad[i].nazev%></option>
                    <% }} %>
                </select>
                <label for="provozovatel">Provozovatel</label>
                <input type="text" name="provozovatel" id="provozovatel" minlength="2" maxlength="255" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+" title="[A-Za-z]" required>
                <label for="znacka">Značka</label>
                <input type="text" name="znacka" id="znacka" minlength="2" maxlength="255" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+" title="[A-Z a-z 0-9 , . -]" required>
                <label for="model">Model</label>
                <input type="text" name="model" id="model" minlength="2" maxlength="255" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+" title="[A-Z a-z 0-9 , . -]" required>
                <label for="barva">Barva</label>
                <input type="text" name="barva" id="barva" minlength="2" maxlength="255" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+" title="[A-Z a-z 0-9 , . -]" required>
                <label for="spz">SPZ</label>
                <input type="text" name="spz" id="spz" minlength="2" maxlength="255" pattern="[A-Z0-9]{3}\s[A-Z0-9]{4}" title="[A-Z0-9]{3}\s[A-Z0-9]{4}" required>
                <label for="vin">VIN</label>
                <input type="text" name="vin" id="vin" minlength="2" maxlength="255" pattern="[A-Z0-9]{17}" title="[A-Z 0-9]" required>
                <label for="vykon_kw">Výkon (kw)</label>
                <input type="number" name="vykon_kw" id="vykon_kw" min="0" required>
                <label for="objem">Objem (L)</label>
                <input type="number" name="objem" id="objem" min="0" required>
                <label for="nej_rychlost">Nejvyšší rychlost (km/h)</label>
                <input type="number" name="nej_rychlost" id="nej_rychlost" min="0" required>
                <label for="rozmery_kol">Rozměry Kol</label>
                <input type="text" name="rozmery_kol" id="rozmery_kol" minlength="2" maxlength="255" pattern="[0-9]{3}/[0-9]{2}R[0-9]{2}" title="[0-9]">
                <button type="submit">Submit</button>
            </form>
        </div>
        <div class="data" style="display: block;">
            <h3>Vyhledávání</h3>
            <form action="/vozidlo/hledat" method="post" id="vozidlo">
                <input type="hidden" name="table" id="table" value="vozidlo" required>
                <label for="id_u">Úřad</label>
                <select name="id_u" id="id_u">
                    <option value="" selected>Vyberte úřad</option>
                    <% if (urad) {
                        for(var i=0; i < urad.length; i++) { %>
                        <option value="<%=urad[i].id_u%>"><%=urad[i].nazev%></option>
                    <% }} %>
                </select>
                <label for="provozovatel">Provozovatel</label>
                <input type="text" name="provozovatel" id="provozovatel" maxlength="255" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+" title="[A-Za-z]">
                <label for="znacka">Značka</label>
                <input type="text" name="znacka" id="znacka" maxlength="255" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+">
                <label for="model">Model</label>
                <input type="text" name="model" id="model" maxlength="255" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+">
                <label for="barva">Barva</label>
                <input type="text" name="barva" id="barva" maxlength="255" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+">
                <label for="spz">SPZ</label>
                <input type="text" name="spz" id="spz" maxlength="255" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+">
                <label for="vin">VIN</label>
                <input type="text" name="vin" id="vin" maxlength="255" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+">
                <label for="vykon_kw">Výkon (kw)</label>
                <input type="number" name="vykon_kw" id="vykon_kw" min="0" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+">
                <label for="objem">Objem (L)</label>
                <input type="number" name="objem" id="objem" min="0" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+">
                <label for="nej_rychlost">Nejvyšší rychlost (km/h)</label>
                <input type="number" name="nej_rychlost" id="nej_rychlost" min="0" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+">
                <label for="rozmery_kol">Rozměry Kol</label>
                <input type="text" name="rozmery_kol" id="rozmery_kol" maxlength="255">
                <button type="submit">Submit</button>
            </form>
            <br>
            <table>
                <tr>
                    <th>ID-V</th>
                    <th>ID-TP</th>
                    <th>Úřad</th>
                    <th>Provozovatel</th>
                    <th>Značka</th>
                    <th>Model</th>
                    <th>Barva</th>
                    <th>SPZ</th>
                    <th>VIN</th>
                    <th>Výkon (kw)</th>
                    <th>Objem (L)</th>
                    <th>Nej. rychlost (km/h)</th>
                    <th>Rozměry kol</th>
                    <th>Upravit</th>
                    <th>Smazat</th>
                </tr>
                <%for(var i=0; i < technickyprukaz.length; i++) { %>
                    <tr id="<%=i%>_technickyprukaz">
                        <td id="<%=i%>_id_v"><%=technickyprukaz[i].id_v%></td>
                        <td id="<%=i%>_id_tp"><%=technickyprukaz[i].id_tp%></td>
                        <td id="<%=i%>_id_u"><%=urad[technickyprukaz[i].id_u -1].nazev%></td>
                        <td id="<%=i%>_provozovatel"><%=technickyprukaz[i].provozovatel%></td>
                        <td id="<%=i%>_znacka"><%=technickyprukaz[i].znacka%></td>
                        <td id="<%=i%>_model"><%=technickyprukaz[i].model%></td>
                        <td id="<%=i%>_barva"><%=technickyprukaz[i].barva%></td>
                        <td id="<%=i%>_spz"><%=technickyprukaz[i].spz%></td>
                        <td id="<%=i%>_vin"><%=technickyprukaz[i].vin%></td>
                        <td id="<%=i%>_vykon_kw"><%=technickyprukaz[i].vykon_kw%></td>
                        <td id="<%=i%>_objem"><%=technickyprukaz[i].objem%></td>
                        <td id="<%=i%>_nej_rychlost"><%=technickyprukaz[i].nej_rychlost%></td>
                        <td id="<%=i%>_rozmery_kol"><%=technickyprukaz[i].rozmery_kol%></td>
                        <td><button onclick="openEdit(<%=i%>)">✏️</button></td>
                        <td><form action="/vozidlo/smazat" method="post"><input type="hidden" name="id" value="<%= technickyprukaz[i].id_tp %>"><button type="submit">❌</button></form></td>
                    </tr> 
                    <% } %>
            </table>
        </div>
        <div class="edit" style="display: none;">
            <h3>Úprava dat</h3>
            <button onclick="closeEdit()">X</button>
            <form action="/vozidlo/upravit" method="post" id="vozidlo">
                <input type="hidden" name="table" id="table" value="vozidlo" required>
                <label for="id_v">ID-V</label>
                <input type="text" name="id_v" id="id_v" required readonly>
                <label for="id_tp">ID-TP</label>
                <input type="text" name="id_tp" id="id_tp" required readonly>
                <label for="id_u">Úřad</label>
                <select name="id_u" id="id_u">
                    <option value="" selected>Vyberte úřad</option>
                    <% if (urad) {
                        for(var i=0; i < urad.length; i++) { %>
                        <option value="<%=urad[i].id_u%>"><%=urad[i].nazev%></option>
                    <% }} %>
                </select>
                <label for="provozovatel">Provozovatel</label>
                <input type="text" name="provozovatel" id="provozovatel" minlength="2" maxlength="255" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+" title="[A-Za-z]" required>
                <label for="znacka">Značka</label>
                <input type="text" name="znacka" id="znacka" minlength="2" maxlength="255" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+" title="[A-Z a-z 0-9 , . -]" required>
                <label for="model">Model</label>
                <input type="text" name="model" id="model" minlength="2" maxlength="255" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+" title="[A-Z a-z 0-9 , . -]" required>
                <label for="barva">Barva</label>
                <input type="text" name="barva" id="barva" minlength="2" maxlength="255" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+" title="[A-Z a-z 0-9 , . -]" required>
                <label for="spz">SPZ</label>
                <input type="text" name="spz" id="spz" minlength="2" maxlength="255" pattern="[A-Za-z0-9\u0080-\uFFFF,.\-\s]+" title="[A-Z 0-9]" required>
                <label for="vin">VIN</label>
                <input type="text" name="vin" id="vin" minlength="2" maxlength="255" pattern="[A-Z0-9]{17}" title="[A-Z 0-9]" required>
                <label for="vykon_kw">Výkon (kw)</label>
                <input type="number" name="vykon_kw" id="vykon_kw" min="0" required>
                <label for="objem">Objem (L)</label>
                <input type="number" name="objem" id="objem" min="0" required>
                <label for="nej_rychlost">Nejvyšší rychlost (km/h)</label>
                <input type="number" name="nej_rychlost" id="nej_rychlost" min="0" required>
                <label for="rozmery_kol">Rozměry Kol</label>
                <input type="text" name="rozmery_kol" id="rozmery_kol" minlength="2" maxlength="255" pattern="[0-9]{3}/[0-9]{2}R[0-9]{2}" title="[0-9]{3}/[0-9]{2}R[0-9]{2}">
                <button type="submit">Submit</button>
            </form>
        </div>
    </main>
    <%- include('../partials/footer'); %>
    <script>
        const insert = document.getElementsByClassName('insert')[0];
        const edit = document.getElementsByClassName('edit')[0];
        const data = document.getElementsByClassName('data')[0];

        function openEdit(id) {
            for (var i = 1; i < 12+1; i++) {
                edit.getElementsByTagName('input')[i].value = document.getElementById(id +'_'+ edit.getElementsByTagName('input')[i].id).innerText;
            }

            for (var i = 0; i < edit.getElementsByTagName('option').length; i++) {
                edit.getElementsByTagName('option')[i].innerText == document.getElementById(id + '_id_u').innerText ? edit.getElementsByTagName('option')[i].selected = true : null;
            }

            edit.style.display = 'block';
            insert.style.display = 'none';
            data.style.display = 'none';
        }

        function closeEdit() {
            edit.style.display = 'none';
            insert.style.display = 'block';
            data.style.display = 'block';
        }
    </script>
</body>
</html>